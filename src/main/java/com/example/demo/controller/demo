package com.example.demo.service;

import java.util.List;
import com.example.demo.entity.StudentProfile;

public interface StudentProfileService {

    StudentProfile createStudent(StudentProfile studentProfile);

    StudentProfile getStudentById(Long id);

    List<StudentProfile> getAllStudents();

    StudentProfile updateRepeatOffenderStatus(Long id);

    StudentProfile getStudentByStudentIdentifier(String studentIdentifier);
}            package com.example.demo.service;

import java.util.List;
import java.util.Optional;
import com.example.demo.entity.IntegrityCase;

public interface IntegrityCaseService {

    IntegrityCase createCase(IntegrityCase integrityCase);

    IntegrityCase updateCaseStatus(Long caseId, String status);

    List<IntegrityCase> getCasesByStudent(Long studentId);

    Optional<IntegrityCase> getCaseById(Long id);

    List<IntegrityCase> getAllCases();
}
 package com.example.demo.repository;

import java.time.LocalDate;
import java.util.List;
import org.springframework.data.jpa.repository.JpaRepository;
import com.example.demo.entity.IntegrityCase;
import com.example.demo.entity.StudentProfile;

public interface IntegrityCaseRepository extends JpaRepository<IntegrityCase, Long> {

    List<IntegrityCase> findByStudentProfile(StudentProfile studentProfile);

    List<IntegrityCase> findByStudentProfile_StudentId(String studentId);

    List<IntegrityCase> findByStatusAndIncidentDateAfter(String status, LocalDate date);

    List<IntegrityCase> findByIncidentDateBetween(LocalDate start, LocalDate end);

    // âœ… Add this for getCasesByStudent(Long id)
    List<IntegrityCase> findByStudentProfile_Id(Long id);
}                                 00000000  package com.example.demo.service.impl;

import com.example.demo.entity.*;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.repository.*;
import com.example.demo.service.StudentProfileService;
import com.example.demo.util.RepeatOffenderCalculator;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class StudentProfileServiceImpl implements StudentProfileService {

    private final StudentProfileRepository repo;
    private final IntegrityCaseRepository caseRepo;
    private final RepeatOffenderRecordRepository recordRepo;
    private final RepeatOffenderCalculator calc;

    public StudentProfileServiceImpl(StudentProfileRepository repo,
                                     IntegrityCaseRepository caseRepo,
                                     RepeatOffenderRecordRepository recordRepo,
                                     RepeatOffenderCalculator calc) {
        this.repo = repo;
        this.caseRepo = caseRepo;
        this.recordRepo = recordRepo;
        this.calc = calc;
    }

    @Override
    public StudentProfile createStudent(StudentProfile s) {
        s.setRepeatOffender(false);
        return repo.save(s);
    }

    @Override
    public StudentProfile getStudentById(Long id) {
        return repo.findById(id)
                   .orElseThrow(() -> new ResourceNotFoundException("Student not found"));
    }

    @Override
    public List<StudentProfile> getAllStudents() {
        return repo.findAll();
    }

    @Override
    public StudentProfile updateRepeatOffenderStatus(Long id) {
        StudentProfile s = getStudentById(id);
        List<IntegrityCase> cases = caseRepo.findByStudentProfile(s);

        RepeatOffenderRecord record = calc.computeRepeatOffenderRecord(s, cases);
        recordRepo.save(record);

        s.setRepeatOffender(record.getTotalCases() >= 2);
        return repo.save(s);
    }

    @Override
    public StudentProfile getStudentByStudentIdentifier(String studentIdentifier) {
        return repo.findByStudentId(studentIdentifier)
                   .orElseThrow(() -> new ResourceNotFoundException("Student not found"));
    }
}
 package com.example.demo.service.impl;

import com.example.demo.entity.*;
import com.example.demo.repository.*;
import com.example.demo.service.IntegrityCaseService;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service
public class IntegrityCaseServiceImpl implements IntegrityCaseService {

    private final IntegrityCaseRepository repo;
    private final StudentProfileRepository studentRepo;

    public IntegrityCaseServiceImpl(IntegrityCaseRepository repo, StudentProfileRepository studentRepo) {
        this.repo = repo;
        this.studentRepo = studentRepo;
    }

    @Override
    public IntegrityCase createCase(IntegrityCase c) {
        if (c.getStudentProfile() == null || c.getStudentProfile().getId() == null)
            throw new IllegalArgumentException("Student missing");

        studentRepo.findById(c.getStudentProfile().getId())
                   .orElseThrow(() -> new IllegalArgumentException("Student missing"));

        return repo.save(c);
    }

    @Override
    public IntegrityCase updateCaseStatus(Long id, String status) {
        IntegrityCase c = repo.findById(id).orElseThrow();
        c.setStatus(status);
        return repo.save(c);
    }

    @Override
    public List<IntegrityCase> getCasesByStudent(Long studentId) {
        return repo.findByStudentProfile_Id(studentId);
    }

    @Override
    public Optional<IntegrityCase> getCaseById(Long id) {
        return repo.findById(id);
    }

    @Override
    public List<IntegrityCase> getAllCases() {
        return repo.findAll();
    }
}
