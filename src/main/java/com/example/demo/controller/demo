package com.example.demo.service;

import java.util.List;
import com.example.demo.entity.StudentProfile;

public interface StudentProfileService {

    StudentProfile createStudent(StudentProfile studentProfile);

    StudentProfile getStudentById(Long id);

    List<StudentProfile> getAllStudents();

    StudentProfile updateRepeatOffenderStatus(Long studentId);
}    0000000000 package com.example.demo.service.impl;

import java.util.List;

import com.example.demo.entity.IntegrityCase;
import com.example.demo.entity.RepeatOffenderRecord;
import com.example.demo.entity.StudentProfile;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.repository.IntegrityCaseRepository;
import com.example.demo.repository.RepeatOffenderRecordRepository;
import com.example.demo.repository.StudentProfileRepository;
import com.example.demo.service.StudentProfileService;
import com.example.demo.util.RepeatOffenderCalculator;

public class StudentProfileServiceImpl implements StudentProfileService {

    private final StudentProfileRepository studentRepo;
    private final IntegrityCaseRepository caseRepo;
    private final RepeatOffenderRecordRepository repeatRepo;
    private final RepeatOffenderCalculator calculator;

    // ðŸ”¥ EXACT constructor order (DO NOT CHANGE)
    public StudentProfileServiceImpl(
            StudentProfileRepository studentRepo,
            IntegrityCaseRepository caseRepo,
            RepeatOffenderRecordRepository repeatRepo,
            RepeatOffenderCalculator calculator) {

        this.studentRepo = studentRepo;
        this.caseRepo = caseRepo;
        this.repeatRepo = repeatRepo;
        this.calculator = calculator;
    }

    @Override
    public StudentProfile createStudent(StudentProfile studentProfile) {
        studentProfile.setRepeatOffender(false);
        return studentRepo.save(studentProfile);
    }

    @Override
    public StudentProfile getStudentById(Long id) {
        return studentRepo.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Student not found"));
    }

    @Override
    public List<StudentProfile> getAllStudents() {
        return studentRepo.findAll();
    }

    @Override
    public StudentProfile updateRepeatOffenderStatus(Long studentId) {

        StudentProfile profile = getStudentById(studentId);
        List<IntegrityCase> cases = caseRepo.findByStudentProfile(profile);

        RepeatOffenderRecord record =
                calculator.computeRepeatOffenderRecord(profile, cases);

        repeatRepo.save(record);

        profile.setRepeatOffender(record.getTotalCases() >= 2);
        return studentRepo.save(profile);
    }
}
 package com.example.demo.service;

import java.util.List;
import java.util.Optional;

import com.example.demo.entity.IntegrityCase;

public interface IntegrityCaseService {

    IntegrityCase createCase(IntegrityCase integrityCase);

    IntegrityCase updateCaseStatus(Long caseId, String status);

    List<IntegrityCase> getCasesByStudent(Long studentId);

    Optional<IntegrityCase> getCaseById(Long id);

    List<IntegrityCase> getAllCases();
}   000000   package com.example.demo.service.impl;

import java.util.List;
import java.util.Optional;

import com.example.demo.entity.IntegrityCase;
import com.example.demo.entity.StudentProfile;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.repository.IntegrityCaseRepository;
import com.example.demo.repository.StudentProfileRepository;
import com.example.demo.service.IntegrityCaseService;

public class IntegrityCaseServiceImpl implements IntegrityCaseService {

    private final IntegrityCaseRepository caseRepo;
    private final StudentProfileRepository studentRepo;

    // ðŸ”¥ EXACT order
    public IntegrityCaseServiceImpl(
            IntegrityCaseRepository caseRepo,
            StudentProfileRepository studentRepo) {
        this.caseRepo = caseRepo;
        this.studentRepo = studentRepo;
    }

    @Override
    public IntegrityCase createCase(IntegrityCase integrityCase) {
        if (integrityCase.getStudentProfile() == null) {
            throw new IllegalArgumentException("StudentProfile required");
        }
        return caseRepo.save(integrityCase);
    }

    @Override
    public IntegrityCase updateCaseStatus(Long caseId, String status) {
        IntegrityCase c = caseRepo.findById(caseId)
                .orElseThrow(() -> new ResourceNotFoundException("Case not found"));
        c.setStatus(status);
        return caseRepo.save(c);
    }

    @Override
    public List<IntegrityCase> getCasesByStudent(Long studentId) {
        StudentProfile s = studentRepo.findById(studentId)
                .orElseThrow(() -> new ResourceNotFoundException("Student not found"));
        return caseRepo.findByStudentProfile(s);
    }

    @Override
    public Optional<IntegrityCase> getCaseById(Long id) {
        return caseRepo.findById(id);
    }

    @Override
    public List<IntegrityCase> getAllCases() {
        return caseRepo.findAll();
    }
}
 package com.example.demo.service;

import java.util.List;
import com.example.demo.entity.EvidenceRecord;

public interface EvidenceRecordService {

    EvidenceRecord submitEvidence(EvidenceRecord evidenceRecord);

    List<EvidenceRecord> getEvidenceByCase(Long caseId);

    EvidenceRecord getEvidenceById(Long id);

    List<EvidenceRecord> getAllEvidence();
}               0000000      package com.example.demo.service.impl;

import java.util.List;

import com.example.demo.entity.EvidenceRecord;
import com.example.demo.entity.IntegrityCase;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.repository.EvidenceRecordRepository;
import com.example.demo.repository.IntegrityCaseRepository;
import com.example.demo.service.EvidenceRecordService;

public class EvidenceRecordServiceImpl implements EvidenceRecordService {

    private final EvidenceRecordRepository evidenceRepo;
    private final IntegrityCaseRepository caseRepo;

    // ðŸ”¥ EXACT order
    public EvidenceRecordServiceImpl(
            EvidenceRecordRepository evidenceRepo,
            IntegrityCaseRepository caseRepo) {
        this.evidenceRepo = evidenceRepo;
        this.caseRepo = caseRepo;
    }

    @Override
    public EvidenceRecord submitEvidence(EvidenceRecord evidenceRecord) {
        Long caseId = evidenceRecord.getIntegrityCase().getId();
        IntegrityCase c = caseRepo.findById(caseId)
                .orElseThrow(() -> new ResourceNotFoundException("Case not found"));
        evidenceRecord.setIntegrityCase(c);
        return evidenceRepo.save(evidenceRecord);
    }

    @Override
    public List<EvidenceRecord> getEvidenceByCase(Long caseId) {
        IntegrityCase c = caseRepo.findById(caseId)
                .orElseThrow(() -> new ResourceNotFoundException("Case not found"));
        return evidenceRepo.findByIntegrityCase(c);
    }

    @Override
    public EvidenceRecord getEvidenceById(Long id) {
        return evidenceRepo.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Evidence not found"));
    }

    @Override
    public List<EvidenceRecord> getAllEvidence() {
        return evidenceRepo.findAll();
    }
}
 package com.example.demo.service;

import java.util.List;

import com.example.demo.entity.PenaltyAction;

public interface PenaltyActionService {

    PenaltyAction addPenalty(PenaltyAction penaltyAction);

    PenaltyAction getPenaltyById(Long id);

    List<PenaltyAction> getPenaltiesByCase(Long caseId);

    List<PenaltyAction> getAllPenalties();
}                   00000000           package com.example.demo.service.impl;

import java.util.List;

import com.example.demo.entity.IntegrityCase;
import com.example.demo.entity.PenaltyAction;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.repository.IntegrityCaseRepository;
import com.example.demo.repository.PenaltyActionRepository;
import com.example.demo.service.PenaltyActionService;

public class PenaltyActionServiceImpl implements PenaltyActionService {

    private final PenaltyActionRepository penaltyRepo;
    private final IntegrityCaseRepository caseRepo;

    // ðŸ”¥ EXACT constructor order (DI test safe)
    public PenaltyActionServiceImpl(
            PenaltyActionRepository penaltyRepo,
            IntegrityCaseRepository caseRepo) {

        this.penaltyRepo = penaltyRepo;
        this.caseRepo = caseRepo;
    }

    @Override
    public PenaltyAction addPenalty(PenaltyAction penaltyAction) {

        Long caseId = penaltyAction.getIntegrityCase().getId();

        IntegrityCase integrityCase = caseRepo.findById(caseId)
                .orElseThrow(() -> new ResourceNotFoundException("Case not found"));

        // Business rule: OPEN â†’ UNDER_REVIEW
        integrityCase.setStatus("UNDER_REVIEW");
        caseRepo.save(integrityCase);

        penaltyAction.setIntegrityCase(integrityCase);
        return penaltyRepo.save(penaltyAction);
    }

    @Override
    public PenaltyAction getPenaltyById(Long id) {
        return penaltyRepo.findById(id)
                .orElseThrow(() -> new ResourceNotFoundException("Penalty not found"));
    }

    @Override
    public List<PenaltyAction> getPenaltiesByCase(Long caseId) {
        IntegrityCase integrityCase = caseRepo.findById(caseId)
                .orElseThrow(() -> new ResourceNotFoundException("Case not found"));
        return penaltyRepo.findByIntegrityCase(integrityCase);
    }

    @Override
    public List<PenaltyAction> getAllPenalties() {
        return penaltyRepo.findAll();
    }
}
 package com.example.demo.service;

import com.example.demo.entity.RepeatOffenderRecord;

public interface RepeatOffenderRecordService {

    RepeatOffenderRecord recalculateRepeatOffender(Long studentId);

    RepeatOffenderRecord getByStudentId(Long studentId);
}                    0000000000         package com.example.demo.service.impl;

import java.util.List;

import com.example.demo.entity.IntegrityCase;
import com.example.demo.entity.RepeatOffenderRecord;
import com.example.demo.entity.StudentProfile;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.repository.IntegrityCaseRepository;
import com.example.demo.repository.RepeatOffenderRecordRepository;
import com.example.demo.repository.StudentProfileRepository;
import com.example.demo.service.RepeatOffenderRecordService;
import com.example.demo.util.RepeatOffenderCalculator;

public class RepeatOffenderRecordServiceImpl implements RepeatOffenderRecordService {

    private final StudentProfileRepository studentRepo;
    private final IntegrityCaseRepository caseRepo;
    private final RepeatOffenderRecordRepository repeatRepo;
    private final RepeatOffenderCalculator calculator;

    // ðŸ”¥ EXACT constructor order (DI test safe)
    public RepeatOffenderRecordServiceImpl(
            StudentProfileRepository studentRepo,
            IntegrityCaseRepository caseRepo,
            RepeatOffenderRecordRepository repeatRepo,
            RepeatOffenderCalculator calculator) {

        this.studentRepo = studentRepo;
        this.caseRepo = caseRepo;
        this.repeatRepo = repeatRepo;
        this.calculator = calculator;
    }

    @Override
    public RepeatOffenderRecord recalculateRepeatOffender(Long studentId) {

        StudentProfile student = studentRepo.findById(studentId)
                .orElseThrow(() -> new ResourceNotFoundException("Student not found"));

        List<IntegrityCase> cases = caseRepo.findByStudentProfile(student);

        RepeatOffenderRecord record =
                calculator.computeRepeatOffenderRecord(student, cases);

        repeatRepo.save(record);

        // Keep StudentProfile in sync
        student.setRepeatOffender(record.getTotalCases() >= 2);
        studentRepo.save(student);

        return record;
    }

    @Override
    public RepeatOffenderRecord getByStudentId(Long studentId) {

        StudentProfile student = studentRepo.findById(studentId)
                .orElseThrow(() -> new ResourceNotFoundException("Student not found"));

        return repeatRepo.findByStudentProfile(student)
                .orElseThrow(() -> new ResourceNotFoundException("Repeat record not found"));
    }
}
 